<!-- keycloakComponent.html -->
<div id="keycloakComponent" class="flex justify-end p-4">
    <!-- Login Button (initially shown if not logged in) -->
    <div id="login-content" class="flex justify-center items-center h-full">
        <button class="btn btn-primary" id="loginButton">Login</button>
    </div>

    <!-- Logout Button (shown when logged in) -->
    <div id="logout-content" class="hidden">
        <button class="btn btn-secondary" id="logoutButtonSidebar">Logout</button>
    </div>
</div>

<script>
    // Function to load the Keycloak library dynamically
    function loadKeycloakScript() {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = "https://cdn.jsdelivr.net/npm/keycloak-js@latest/dist/keycloak.min.js";
            script.onload = () => resolve();
            script.onerror = () => reject(new Error('Failed to load Keycloak script'));
            document.head.appendChild(script);
        });
    }

    // Load the Keycloak script, then initialize Keycloak
    loadKeycloakScript()
        .then(() => {
            const keycloak = new Keycloak({
                url: 'https://identityserver.de',
                realm: 'fakturaservice',
                clientId: 'frontendserver-frontend'
            });

            function updateUI(authenticated) {
                const loginContent = document.getElementById('login-content');
                const logoutContent = document.getElementById('logout-content');
                const logoutButton = document.getElementById('logoutButton');
                const authContent = document.getElementById('auth-content');

                if (authenticated) {
                    loginContent.classList.add('hidden');
                    logoutContent.classList.remove('hidden');
                    logoutButton.classList.remove('hidden');  // Show Logout button in header

                    // Show the authenticated content
                    authContent.classList.remove('hidden');
                } else {
                    loginContent.classList.remove('hidden');
                    logoutContent.classList.add('hidden');
                    logoutButton.classList.add('hidden');  // Hide Logout button in header

                    // Hide the authenticated content
                    authContent.classList.add('hidden');
                }
            }

            // Initialize Keycloak and update the UI accordingly
            keycloak.init({ onLoad: 'check-sso', checkLoginIframe: false })
                .then(authenticated => updateUI(authenticated))
                .catch(() => updateUI(false));

            document.getElementById('loginButton').addEventListener('click', () => keycloak.login());
            document.getElementById('logoutButton').addEventListener('click', () => keycloak.logout({ redirectUri: window.location.href }));
            document.getElementById('logoutButtonSidebar').addEventListener('click', () => keycloak.logout({ redirectUri: window.location.href }));
        })
        .catch(error => {
            console.error(error.message);
        });
</script>
